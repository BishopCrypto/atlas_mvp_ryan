# Claude Code Project Notes

## Context Optimization Issues & Solutions

### Problem Identified (2025-01-08)
- Claude tools (LS, Glob) were scanning entire project including node_modules/
- This caused massive context bloat (300k+ tokens for simple queries)
- node_modules alone is ~300MB with thousands of files

### Root Cause
- Tools like `LS` and `Glob` scan filesystem directly, ignoring .gitignore
- Broad directory scans include all files, not just source code
- .gitignore only affects git operations, not filesystem tools

### Solutions Implemented
- **Never use broad directory scans** like `LS /project/root`
- **Use targeted Grep** with file filters: `--glob="*.tsx"` `--type="js"`
- **Only read specific files** mentioned by user
- **Avoid root directory operations** that could trigger recursive scans

### Best Practices Going Forward
1. When user mentions a file, read that specific file only
2. Use Grep with file type filters instead of broad searches
3. Ask user for specific file paths rather than scanning
4. Document these patterns to prevent regression

## Multi-Tenant Architecture Notes

### Database Schema
- `tenants` table for Disney, Virgin, etc.
- All data tables have `tenant_id` for isolation
- Row Level Security (RLS) enforces tenant boundaries
- Fixed infinite recursion issue with SECURITY DEFINER function

### Current Status
- Database schema deployed to Supabase
- Interface still uses hardcoded data (needs update)
- RLS policies working correctly after fix

## Development Workflow
- Always commit before major changes
- Use targeted file operations to minimize context
- Document architectural decisions in this file

## Future Features (TODO Later)
- **Audit Log System**: Need to implement comprehensive audit logging for all user actions, data changes, and system events. This should track who did what, when, and from where for compliance and security purposes.
- **Continuous Alerting & Live Monitoring**: Need to implement real-time alerting system with live monitoring updates. Should show continuous alerts somewhere in the UI for ongoing security events, flagged items, and system status changes.
- **Mobile Optimized Version**: Need to create mobile-optimized version of the dashboard for on-the-go access by security personnel and management.
- **Itinerary Insights**: Need to implement trip insights showing ship trips and other operational issues. Should provide detailed analysis of itineraries, route deviations, and related security concerns.
- **Heat Spots on Ship Maps**: Need to add interactive maps showing heat spots on each ship. Should visualize high-activity areas, security incidents, and crowd density patterns for better situational awareness.
- **Enhanced Risk Screening & Financial Profiling**: Need to implement advanced screening for 'credit card compromised' and 'sex offender in family' alerts. Include credit card type analysis for chargeback likelihood and spending patterns. Add monthly reports tab showing screening statistics (detected and validated X people, rejected 1 murderer, etc.).